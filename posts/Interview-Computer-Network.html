<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Computer Network Basics, Chenのblog"><meta name="description" content="计算机网络知识点汇总"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>Computer Network Basics | Chenのblog</title><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/logo.png"><style>body{background-image:url(https://gitee.com/marmalade0/images/blob/master/www.marmalade.vip/24.jpg);background-repeat:no-repeat;background-size:100% 100%;background-attachment:fixed}</style><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" type="text/css" href="/css/reward.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 7.3.0"></head><style type="text/css" lang="css">#loading-container{position:fixed;top:0;left:0;min-height:100vh;width:100vw;z-index:9999;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;text-align:center;-webkit-transition:opacity 1s ease;-moz-transition:opacity 1s ease;-o-transition:opacity 1s ease;transition:opacity 1s ease}.loading-image{width:120px;height:50px;transform:translate(-50%)}.loading-image div:nth-child(2){-webkit-animation:pacman-balls 1s linear 0s infinite;animation:pacman-balls 1s linear 0s infinite}.loading-image div:nth-child(3){-webkit-animation:pacman-balls 1s linear .33s infinite;animation:pacman-balls 1s linear .33s infinite}.loading-image div:nth-child(4){-webkit-animation:pacman-balls 1s linear .66s infinite;animation:pacman-balls 1s linear .66s infinite}.loading-image div:nth-child(5){-webkit-animation:pacman-balls 1s linear .99s infinite;animation:pacman-balls 1s linear .99s infinite}.loading-image div:first-of-type{width:0;height:0;border:25px solid #49b1f5;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_up .5s 0s infinite;animation:rotate_pacman_half_up .5s 0s infinite}.loading-image div:nth-child(2){width:0;height:0;border:25px solid #49b1f5;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_down .5s 0s infinite;animation:rotate_pacman_half_down .5s 0s infinite;margin-top:-50px}@-webkit-keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@-webkit-keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@-webkit-keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}@keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}.loading-image div:nth-child(3),.loading-image div:nth-child(4),.loading-image div:nth-child(5),.loading-image div:nth-child(6){background-color:#49b1f5;width:15px;height:15px;border-radius:100%;margin:2px;width:10px;height:10px;position:absolute;transform:translateY(-6.25px);top:25px;left:100px}.loading-text{margin-bottom:20vh;text-align:center;color:#2c3e50;font-size:2rem;box-sizing:border-box;padding:0 10px;text-shadow:0 2px 10px rgba(0,0,0,.2)}@media only screen and (max-width:500px){.loading-text{font-size:1.5rem}}.fadeout{opacity:0}@-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}@keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0)}}</style><script>(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },2500); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()</script><body><div id="loading-container"><p class="loading-text">嘘~ 正在从服务器偷取页面 . . .</p><div class="loading-image"><div></div><div></div><div></div><div></div><div></div></div></div><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">Chenのblog</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/logo.png" class="logo-img circle responsive-img"><div class="logo-name">Chenのblog</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/b271e2b2707f3530b45cf76acededfe37f07fd9ce20b277e0ba55c8597491243.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Computer Network Basics</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Computer-Network/"><span class="chip bg-color">Computer Network</span> </a><a href="/tags/Interview/"><span class="chip bg-color">Interview</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Computer-Basics/" class="post-category">Computer Basics</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2024-08-24</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2024-08-26</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 9.7k</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.min.css"><div class="card-content article-card-content"><div id="articleContent"><h2 id="1-计算机网络体系结构"><a href="#1-计算机网络体系结构" class="headerlink" title="1. 计算机网络体系结构"></a>1. 计算机网络体系结构</h2><h3 id="1-1-计算机网络的主要功能"><a href="#1-1-计算机网络的主要功能" class="headerlink" title="1.1 计算机网络的主要功能"></a>1.1 计算机网络的主要功能</h3><ol><li><strong>硬件资源共享</strong><ul><li>可以在全网范围内提供对处理资源、存储资源、输入输出资源等昂贵设备的共享，使用户节省投资，也便于集中管理和均衡分担负荷。</li></ul></li><li><strong>软件资源共享</strong><ul><li>允许互联网上的用户远程访问各类大弄数据库，可以得到网络文件传送服务、远地进程管理服务 和远程文件访问服务，从而避免软件研制上的重复劳动以及数据资源的重复存贮，也便于集中管理。</li></ul></li><li><strong>用户间信息交换</strong><ul><li>计算机网络为分布在各地的用户提供了强有力的通信手段。用户可以通过计算机网络传送电子邮件、发布新闻消息和进行电子商务活动。</li></ul></li><li><strong>分布式处理</strong><ul><li>当计算机网络中某个计算机系统负荷过重时，可以将其处理的某个复杂任务分配给网络中的其他计算机系统，从而利用空闲计算机资源以提高整个系统的利用率。</li></ul></li></ol><h3 id="1-2-主机间的通信方式"><a href="#1-2-主机间的通信方式" class="headerlink" title="1.2 主机间的通信方式"></a>1.2 主机间的通信方式</h3><ol><li><strong>客户-服务器（C&#x2F;S）</strong><ul><li>客户是服务请求方，服务器是服务的提供方。</li></ul></li><li><strong>对等（P2P）</strong><ul><li>不区分客户和服务器。</li></ul></li></ol><h3 id="1-3-电路交换，报文交换和分组交换的区别"><a href="#1-3-电路交换，报文交换和分组交换的区别" class="headerlink" title="1.3 电路交换，报文交换和分组交换的区别"></a>1.3 电路交换，报文交换和分组交换的区别</h3><p>电路交换、报文交换和分组交换是三种不同的通信方式，用于在网络中传输数据。它们在数据传输的方式、效率和适用场景上有明显的区别。</p><ol><li><p><strong>电路交换</strong></p><ul><li>电路交换是一种传统的通信方式，主要用于电话网络。包括建立连接、传输数据和断开连接三个阶段。一旦建立了这条电路，通信双方可以独占这条路径进行数据传输，直到通信结束。</li><li>特点：<ul><li><strong>专用通道</strong>：通信开始前需要建立一条固定的通道，通道独占，直到通信结束。</li><li><strong>实时性强</strong>：数据传输是连续的，适合实时通信，如语音通话。</li><li><strong>资源利用率低</strong>：即使在通信过程中没有数据传输，这条通道仍然被占用，导致资源利用效率较低。</li></ul></li></ul></li><li><p><strong>报文交换</strong></p><ul><li>将整个报文转发到相邻结点，全部存储下来，查找转发表，转发到下一个结点。是<strong>存储-转发</strong>类型的网络。</li><li>特点：<ul><li><strong>无专用通道</strong>：不需要在发送端和接收端之间建立专用通道。</li><li><strong>灵活性高</strong>：数据可以根据网络状况选择不同的路径传输。</li><li><strong>延时较大</strong>：因为中间节点需要存储和转发整个报文，可能导致较大的传输延时。</li></ul></li></ul></li><li><p>分组交换</p><ul><li>分组交换是将数据分割成较小的分组（数据包）进行传输，每个分组包含目的地址等控制信息。每个分组独立在网络中传输，可能经过不同的路径到达目的地。到达目的地后，分组会被重新组装成原始数据。</li><li>特点：<ul><li><strong>高效利用网络资源</strong>：分组交换允许多个用户共享网络带宽，数据包可以在不同路径上进行传输，提高了网络资源的利用率。</li><li><strong>鲁棒性强</strong>：如果某条路径发生故障，数据包可以通过其他路径传输，提高了传输的可靠性。</li><li><strong>适用于突发性流量</strong>：分组交换非常适合互联网等网络流量较为突发的场景，如网页浏览和数据传输。</li></ul></li></ul></li></ol><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/20240825140030.png" alt="图1 三种通信方式" width="500"><h3 id="1-4-计算机网络的主要性能指标"><a href="#1-4-计算机网络的主要性能指标" class="headerlink" title="1.4 计算机网络的主要性能指标"></a>1.4 计算机网络的主要性能指标</h3><ol><li><p><strong>宽带（Bandwidth）</strong></p><ul><li>原本表示通信线路允许通过的信号频带范围。在计算机网络中，表示网络的通信线路所能传送数据的能力，是能传送的“最高数据率”的同义词，单位是比特每秒（b&#x2F;s）。</li></ul></li><li><p><strong>时延（Delay）</strong></p><ul><li><strong>排队时延</strong>：分组在路由器的输入队列和输出队列中排队等待的时间，取决于网络当前的通信量。</li><li><strong>处理时延</strong>：主机或者路由器收到分组时进行处理所需要的时间，例如分析首部、从分组中提取数据、进行差错检验或查找适当的路由等。</li><li><strong>传输时延</strong>：传输时延又称为发送时延，表示结点将分组所有比特推向链路所需要的时间。</li><li><strong>传播时延</strong>：电磁波在信道中传播所需要花费的时间，电磁波传播的速度接近光速。</li></ul></li></ol><p>$$<br>\text{总时延} &#x3D; \text{排队时延} + \text{处理时延} + \text{传输时延} + \text{传播时延}<br>$$</p><ol start="3"><li><strong>时延宽带积</strong></li></ol><ul><li>指的是发送端发送的第一个比特即将到达终点时，发送端已经发送了多少个比特，因此又称以比特为单位的链路长度，即 $\text{时延宽带积}&#x3D;\text{传播时延} \times \text{信道带宽}$。</li></ul><h3 id="1-5-ISO-OSI-参考模型和TCP-IP-模型"><a href="#1-5-ISO-OSI-参考模型和TCP-IP-模型" class="headerlink" title="1.5 ISO&#x2F;OSI 参考模型和TCP&#x2F;IP 模型"></a>1.5 ISO&#x2F;OSI 参考模型和TCP&#x2F;IP 模型</h3><h4 id="TCP-IP-网络模型总览"><a href="#TCP-IP-网络模型总览" class="headerlink" title="TCP&#x2F;IP 网络模型总览"></a>TCP&#x2F;IP 网络模型总览</h4><div class="markmap-container" style="height:250px"><svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[0,1]},&quot;v&quot;:&quot;TCP/IP&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;应用层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;HTTP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;Telnet&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;FTP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;TFTP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;DNS&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;SMTP&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;传输层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;四层交换机、四层路由器&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;TCP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;UDP&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;网络层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;路由器、三层交换机&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;IP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;ICMP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;RIP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;IGMP&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;数据链路层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;网卡、网桥、以太网交换机&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;ARP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;RARP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;IEEE80 2.3&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[26,27]},&quot;v&quot;:&quot;PPP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[27,28]},&quot;v&quot;:&quot;CSMA/CD&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[29,30]},&quot;v&quot;:&quot;物理层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[30,31]},&quot;v&quot;:&quot;明线、电缆、光纤、中继器等&quot;}]}]}"></svg></div><p>同一台设备的的进程间通信方式有很多，比如管道、消息队列、共享内存、信号等方式，而对于不同设备上的进程间通信，就需要网络通信，又由于设备是多样的，所以要兼容各种各样的设备，就协商出一套<strong>通用的网络协议</strong>。</p><h4 id="应用层（Application-Layer）"><a href="#应用层（Application-Layer）" class="headerlink" title="应用层（Application Layer）"></a>应用层（Application Layer）</h4><p>最上层的，就是直接能接触到的应用层（OSI：应用层+ 表示层+ 会话层），设备是使用的应用软件都是在应用层实现。当两个设备需要通信时，应用就把应用数据传给下一层，即传输层。所以，应用层只需要专注于为用户提供应用功能，比如<code>HTTP</code>、<code>FTP</code>、<code>DNS</code>、<code>SMTP</code>等。</p><h4 id="传输层（Transport-Layer）"><a href="#传输层（Transport-Layer）" class="headerlink" title="传输层（Transport Layer）"></a>传输层（Transport Layer）</h4><p>应用层的数据包会传给传输层，<strong>传输层</strong>是为应用层提供网络支持的。在传输层会有两个传输协议，分别是<code>TCP</code>和<code>UDP</code>。</p><p><code>TCP</code>全称叫传输控制协议（Transmission Control Protocol），大部分应用使用的正是<code>TCP</code>传输层协议，比如<code>HTTP</code>协议。<code>TCP</code>相比<code>UDP</code>多了很多特性，比如流量控制、超时重传、拥塞控制等，这些都是为了保证数据包能可靠的传输给对方。</p><p><code>UDP</code>与<code>TCP</code>相比就简单许多，该协议只负责转发数据包，不保证数据能够送到接收方，因此其实时性相对更好，传输的效率也更高。</p><p>应用需要传输的数据可能会非常大，因此如果在传输层直接传输就不好控制，因此当传输层的数据包大小超过MSS（TCP 最大报文段长度），就要将数据分段，即使某个分段丢失或损坏，也只需要重新发送这一分块，而不是重新发送整个数据包。其中在<code>TCP</code>协议中，称之为TCP 端。</p><p>当设备需要接收数据时，传输层要负责把数据包传给应用，此时就需要使用<strong>端口</strong>来将应用区分开来。常见的端口比如<code>80</code>端口通常是Web 服务器用的，<code>22</code>端口通常是远程登录服务器用的。浏览器中每个标签栏都是一个独立的进程，操作系统会给这些进程分配临时的端口号。</p><h4 id="网络层（Internet-Layer）"><a href="#网络层（Internet-Layer）" class="headerlink" title="网络层（Internet Layer）"></a>网络层（Internet Layer）</h4><p>实际场景中的网络错综复杂。如果一个设备数据要传送给另一个设备，就需要在各种各样的结点中选择，然而，传输层的设计理念是简单、高效、专注，如果传输层还负责这一块功能就会违背设计的原则，即传输层只负责服务号应用即可，让其作为应用间数据传输的媒介，帮助实现应用到应用的通信，而实际传输功能为其下一层，也就是<strong>网络层</strong>。</p><p>网络层最常使用的协议是 IP 协议（Internet Protocal），该协议将传输层的报文作为数据部分，再加上IP包头组装成 IP 报文，如果 IP 报文长度超过 MTU（ 以太网一般为 1500 字节）就会<strong>再次分片</strong>，得到一个即将发送到网络的 IP 报文。</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/12.jpg" alt="图2 报文流动过程" width="500"><p>网络层一般使用 IP 地址给设备进行编号，对于 IPv4 协议，IP 地址共 32 位，分为四段，每段 8 位。每个 IP 地址由<strong>网络号</strong>和<strong>主机号</strong>组成。</p><ul><li><strong>网络号</strong>：负责标识该 IP 地址属于哪个<strong>子网</strong>。</li><li><strong>主机号</strong>：负责标识同一个子网下的<strong>不同主机</strong>。</li></ul><p>那么哪几位为网络号？哪几位为主机号？此时就需要使用<strong>子网掩码</strong>进行计算。计算方式为将 IP 地址与子网掩码进行按位与运算，就可以得到网络号；子网掩码取反后与 IP 地址进行按位与运算，就可以得到主机号。</p><p>IP 地址除了寻址，还有一个功能就是路由。路由器在寻址的过程中，就是要找到目标地址的子网，找到后进而把数据包转发给对应的网络去。</p><p><strong>总结，IP 协议的寻址功能就是告诉报文下一个目的地该朝哪个方向走，路由则是根据下一个目的地选择路径。</strong></p><h4 id="网络接口层（Link-Layer）"><a href="#网络接口层（Link-Layer）" class="headerlink" title="网络接口层（Link Layer）"></a>网络接口层（Link Layer）</h4><p>有了 IP 地址后，接下来就要交给数据链路层（数据链路层 + 物理层），在 IP 报文的加上 MAC 头部，并封装成数据帧（Data frame）发送到网络上。<br>为何有了 IP 地址，还需要加入 MAC 地址，这是因为以太网其实是一种局域网，把附近的设备连接起来，从而进行通信的技术，在判断网络包是否到达目的地时，必须采用相匹配的方式才能在以太网中将包发往目的地，因此需要使用 MAC 头部中的 MAC 地址，该地址可以通过<code>ARP</code>协议获取对方的 MAC 地址。</p><p><strong>总结，数据链路层主要是为网络层提供链路级别的数据传输服务，在底层网络上发送数据包，工作在网卡这个层次，使用 MAC 地址来标识网络上的设备</strong>。</p><hr><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost3@main/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%B5%AE%E7%82%B9/%E5%B0%81%E8%A3%85.png" alt="图3 不同层级的数据封装" width="500"><p>数据链路层的传输单位是帧（frame），网络层的传输单位是包（packet），运输层的传输单位是段（segment），应用层的传输单位则是消息或报文（message），所有的名词可以统称为数据包。</p><h2 id="2-应用层"><a href="#2-应用层" class="headerlink" title="2. 应用层"></a>2. 应用层</h2><h3 id="2-1-应用层总览"><a href="#2-1-应用层总览" class="headerlink" title="2.1 应用层总览"></a>2.1 应用层总览</h3><div class="markmap-container" style="height:400px"><svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;应用层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;网络应用模型&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;C/S模型：区分处理请求的服务器和发出请求的客户机&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;P2P模型：每台机器既是服务器又是客户机&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;域名解析（DNS）&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;作用：把主机名转化为IP地址&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;协议与端口：运行在UDP之上，使用53端口&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;服务器分类&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;根域名服务器：知道所有顶级域名服务器的IP地址&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;顶级域名服务器：负责管理在其服务器注册的所有二级域名&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;授权域名服务器：能够将其管辖的主机名转换为该主机的IP地址&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;本地域名服务器：本地网络提供商负责的域名服务器&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;查询方式&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;递归查询：由查询服务器发起下一次的查询&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;递归与迭代：出了第一个查询外，其余均有本地域名服务器向外查询&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;文件传输协议（FTP）&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[26,27]},&quot;v&quot;:&quot;作用：允许用户在因特网上存取文件&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[28,29]},&quot;v&quot;:&quot;协议与端口：运行在TCP上，控制链接为21号端口，数据链接20号端口&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[30,31]},&quot;v&quot;:&quot;电子邮件&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[31,32]},&quot;v&quot;:&quot;STMP&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[32,33]},&quot;v&quot;:&quot;作用：向邮件服务器主动发送电子邮件&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[34,35]},&quot;v&quot;:&quot;协议与端口：运行在TCP上，使用25号端口&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[36,37]},&quot;v&quot;:&quot;POP3&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[37,38]},&quot;v&quot;:&quot;作用：向邮件服务器要求接收电子邮件&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[38,39]},&quot;v&quot;:&quot;协议与端口：运行在TCP上，使用110号端口&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[40,41]},&quot;v&quot;:&quot;万维网&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[41,42]},&quot;v&quot;:&quot;统一资源定位符（URL）：负责标识万维网上的各种文档&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[42,43]},&quot;v&quot;:&quot;超文本传输协议&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[43,44]},&quot;v&quot;:&quot;作用：在万维网上能够可靠地交换文件&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[44,45]},&quot;v&quot;:&quot;协议与端口：运行在TCP之上，使用80号端口&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[45,46]},&quot;v&quot;:&quot;超文本标记语言：文档结构标记语言，使用约定的标记对页面上的各种信息进行描述&quot;}]}]}"></svg></div><h3 id="2-2-DNS-域名解析协议"><a href="#2-2-DNS-域名解析协议" class="headerlink" title="2.2 DNS 域名解析协议"></a>2.2 DNS 域名解析协议</h3><p>域名解析就是把域名映射成 IP 地址或把 IP 地址映射成域名的过程。前者为正向解析，后者称为反向解析。当客户端需要域名解析时，通过本机 DNS 客户端构造一个 DNS 请求报文，以 <code>UDP</code> 数据报方式发送到本地域名服务器。解析的方式有两种：</p><ul><li>递归查询</li><li>递归与迭代相结合的查询</li></ul><p>其中递归与迭代相结合的查询方式更为常见，其工作流程如下：</p><ol><li>客户端首先会发送一个 DNS 请求给本地域名服务器，目的是让本地域名服务器替本地主机查询服务器的 IP 地址。</li><li>本地域名服务器收到客户端的请求后，首先会在缓存中寻找时候有对应的 <code>&lt; 域名, IP&gt;</code>，如果有则直接返回 IP 地址；如果没有，本地 DNS 会去访问其根域名服务器。</li><li>根域名服务器并不会直接替其递归查询目标 IP 地址，而是查询顶级域名服务器的 IP 地址并返回顶级域名服务器的 IP 地址给本地域名服务器。本地域名服务器根据收到的顶级域名服务器 IP 地址，接着发送询问请求。</li><li>顶级域名服务器也并不会替其递归查询目标 IP 地址，而是返回对应的权威域名服务器的 IP 地址给本地域名服务器。本地服务器接着询问权威服务器。</li><li>权威服务器知道目标服务器的 IP 地址，因此返回给本地域名服务器目标服务器的 IP 地址。</li><li>本地域名服务器再将目标服务器的 IP 地址返回给客户端。至此，客户端完成 DNS 解析。</li></ol><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%94%AE%E5%85%A5%E7%BD%91%E5%9D%80%E8%BF%87%E7%A8%8B/6.jpg" alt="图4 DNS 解析过程" width="600"><h3 id="2-3-FTP-文件传输协议"><a href="#2-3-FTP-文件传输协议" class="headerlink" title="2.3 FTP 文件传输协议"></a>2.3 FTP 文件传输协议</h3><p>文件传输协议（File Transfer Protocol，FTP）是因特网上使用的最广泛的文件传输协议。FTP 提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限，适用于异构网络中任意计算机之间传送文件。FTP 提供以下功能：</p><ol><li>提供不同种类主机系统之间的文本传输能力。</li><li>以用户权限管理的方式提供用户对远程 FTP 服务器上的文件管理能力。</li><li>以匿名 FTP 的方式提供公用文件共享的能力。</li></ol><p>FTP 采用 C&#x2F;S 工作方式，使用<code>TCP</code>进行可靠传输服务。一个 FTP 服务器进程可以同时为多个客户进程提供服务。FTP 的服务器进程分为两大部分组成：一个主进程，负责接收新的请求；另外有若干从属进程，负责处理单个请求。工作步骤如下：</p><ol><li>服务器打开21 号端口，使客户进程能够连接上。</li><li>等待客户进程发连接请求。</li><li>启动从属进程来处理客户进程发来的请求。主进程与从属进程并发执行，从属进程对客户进程的请求处理完毕后即终止。</li><li>回到等待状态，继续接收其他客户进程的请求。</li></ol><h3 id="2-4-SMTP-简单邮件传输协议"><a href="#2-4-SMTP-简单邮件传输协议" class="headerlink" title="2.4 SMTP 简单邮件传输协议"></a>2.4 SMTP 简单邮件传输协议</h3><p>简单邮件传输协议（Simple Mail Transfer Protocol, SMTP） 是一种提供可靠且有效的电子邮件传输的协议，它控制两个相互通信的 SMTP 进程交换信息。由于 SMTP 使用 C&#x2F;S 方式，因此负责发送邮件的 SMTP 进程就是SMTP 客户，而负责接收邮件的 SMTP 进程就是 SMTP 服务器。SMTP 用的是<code>TCP</code>连接，端口号为25 。</p><h3 id="2-5-POP3-邮局协议"><a href="#2-5-POP3-邮局协议" class="headerlink" title="2.5 POP3 邮局协议"></a>2.5 POP3 邮局协议</h3><p>邮局协议（Post Office Protocol, POP） 是一个非常简单但功能有限的邮件读取协议，POP3 采用的是拉（Pull） 的通信方式，当用户读取邮件时，用户代理向邮件服务器发出请求，POP 也使用 C&#x2F;S 的工作方式，在传输层使用<code>TCP</code>, 端口号为110 。</p><p>随着万维网的流行，目前出现了很多基于万维网的电子邮件，如<code>Hotmail</code>、<code>Gmail</code>等。这种电子 邮件的特点是，用户浏览器与<code>Hotmail</code>或<code>Gmail</code>的邮件服务器之间的邮件发送或接收使用的是 <code>HTTP</code>, 而仅在不同邮件服务器之间传送邮件时才使用<code>SMTP</code>。</p><h3 id="2-6-HTTP-超文本传输协议"><a href="#2-6-HTTP-超文本传输协议" class="headerlink" title="2.6 HTTP 超文本传输协议"></a>2.6 HTTP 超文本传输协议</h3><p>HTTP 定义了浏览器怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。</p><blockquote><p>那么当浏览器键入网址后，到网页显示，期间发生了什么呢？</p></blockquote><h4 id="HTTP-：解析URL"><a href="#HTTP-：解析URL" class="headerlink" title="HTTP ：解析URL"></a>HTTP ：解析URL</h4><p>首先浏览器做的第一步工作就是将网址进行解析，只有解析完了网址，才知道请求信息需要发送到哪个服务器。一个URL 通常由这么几个部分构成<code>http://Web服务器地址/目录名/文件名</code>，其中<code>目录名/文件名</code>是可以被省略掉的，没有路径名时，就代表访问根目录下<strong>默认文件</strong>。根据 URL 拆分得到如下几个部分：</p><ul><li>数据协议：URL开头的部分，即<code>http:</code></li><li>服务器地址：&#x2F;&#x2F; 后面的字符串标识服务器地址</li><li>数据源路径名：服务器地址后跟着的路径名</li></ul><p>对 URL 进行解析之后，浏览器确定了 Web 服务器和文件名，根据这些信息生成 HTTP 请求消息。</p><h4 id="DNS-：查询IP-地址"><a href="#DNS-：查询IP-地址" class="headerlink" title="DNS ：查询IP 地址"></a>DNS ：查询IP 地址</h4><p>再发送 HTTP 请求信息之前，还有一项工作，即<strong>查询服务器域名对应的IP地址</strong>，因为委托操作系统发送消息时，必须提供通信对象的 IP 地址。因此，DNS 服务器就派上用场了。当然，并不是每次都需要这个步骤，如果缓存中有对应的域名，就无需进行 DNS 解析，直接返回该域名对应的 IP 地址。</p><h4 id="协议栈：分层管理"><a href="#协议栈：分层管理" class="headerlink" title="协议栈：分层管理"></a>协议栈：分层管理</h4><p>得到了目标服务器的 IP 地址后，就可以把 HTTP 的传输工作交给操作系统的<strong>协议栈</strong>。协议栈分为好几个部分，分别承担自己的工作，上面的部分会向下面委托工作，下面的部分收到委托的工作并执行。</p><p>浏览器通过调用<code>Socket</code>库，来委托协议栈工作。其中上半部分为负责收发数据的<code>TCP</code>与<code>UDP</code>协议，受到应用层的委托执行收发数据的操作；下半部分用<code>IP</code>协议控制网络包收发操作，在互联网上传数据时，切分成数据包，而将网络包发送给对方的操作就是由<code>IP</code>负责的。</p><p>其中<code>IP</code>还包括其他协议：</p><ul><li><code>ICMP</code>用于告知网络包传送过程中产生的错误以及各种控制信息。</li><li><code>ARP</code>用于根据 IP 地址查询对应的以太网 MAC 地址。</li></ul><blockquote><p>Notice：虽然<code>ARP</code>协议需要使用 IP 地址进行工作，但是其仍然为数据链路层的协议，这是因为<code>ARP</code>的主要功能是处理局域网内的地址解析，直接影响数据链路层的操作。</p></blockquote><p>IP 下面的网卡驱动负责控制网卡硬件，网卡负责完成实际的数据收发操作。</p><h4 id="TCP-：可靠传输"><a href="#TCP-：可靠传输" class="headerlink" title="TCP ：可靠传输"></a>TCP ：可靠传输</h4><p><code>HTTP</code>是基于<code>TCP</code>的协议传输的，首先根据<code>TCP</code>的报文头部查看需要哪些字段信息。</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/5d0c331c5378f22175.jpg" alt="图5 TCP 报文头部格式" width="500"><ul><li><strong>源端口</strong>和<strong>目的端口</strong>：用来标识发送给主机上哪个应用程序的。</li><li><strong>序号</strong>：为了解决包乱序的问题，给数据标号。</li><li><strong>确认号</strong>：目的是确认发出去对方是否有收到。如果没有收到就应该重新发送，用于解决发送过程中出现的丢包问题。</li><li><strong>状态位</strong>：<code>TCP</code>是面向连接的服务，因此双方需要维护连接状态，因此标识就起到了很重要的作用，如<code>SYN</code>标识发起一个请求，<code>ACK</code>是回复，<code>RST</code>是重新连接，<code>FIN</code>是结束连接……</li><li><strong>窗口大小</strong>：<code>TCP</code>要实现<strong>流量控制</strong>，通信双方各声明一个窗口（缓存大小），标识自己当前能够处理能力。</li></ul><p>除了流量控制，<code>TCP</code>还会用<strong>拥塞控制</strong>，控制发送速度。</p><p><code>TCP</code>传输数据之前，还要进行三次握手建立连接。</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/35-handshake.png" alt="图6 三次握手" width="500"><p>三次握手的流程如下：</p><ol><li>客户端和服务端都处于<code>CLOSED</code>状态，先是服务器主动监听某个端口，处于<code>LISTEN</code>状态。</li><li>客户端主动发起连接<code>SYN</code>，之后处于<code>SYN-SENT</code>状态。</li><li>服务器接收到连接请求，返回<code>SYN</code>，并且<code>ACK</code>客户端的<code>SYN</code>，之后处于<code>SYN-RCVD</code>状态。</li><li>客户端收到服务端发送的<code>SYN</code>和<code>ACK</code>之后，发送对<code>SYN</code>确认的<code>ACK</code>，之后处于<code>ESTABLISHED</code>状态。因为完成一发收。</li><li>服务端收到<code>ACK</code>之后，处于<code>ESTABLISHED</code>状态，因为完成一发收。</li></ol><p>所以三次握手目的是<strong>保证双方都有发送和接收的能力</strong>。</p><h4 id="IP-远程定位"><a href="#IP-远程定位" class="headerlink" title="IP : 远程定位"></a>IP : 远程定位</h4><p><code>TCP</code>需要委托<code>IP</code>将数据封装成数据包发送给通信对象。<code>IP</code>的头部组成部分如下所示。</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/5d0c3dedd0fa910049.jpg" alt="图7 IP  报文格式" width="500"><ul><li><strong>源地址</strong>和<strong>目标地址</strong>：前者即客户端的输入的 IP 地址；后者即目标主机的 IP 地址。</li><li><strong>协议号</strong>：由于<code>HTTP</code>是使用<code>TCP</code>传输的，因此数据包头部需要填写<code>0x06</code>，标识协议为<code>TCP</code>。</li></ul><h4 id="MAC-：两点传输"><a href="#MAC-：两点传输" class="headerlink" title="MAC ：两点传输"></a>MAC ：两点传输</h4><p>生成了 IP 头部之后，接下来网络包还需要在 IP 头部的前面加上 MAC 头部。MAC 头部是以太网的头部，它包含了接收方和发送方的 MAC 地址等信息。</p><p>在 MAC 包头里需要<strong>发送方MAC地址</strong>和<strong>接收方MAC地址</strong>，用于两点传输。一般在 TCP&#x2F;IP 通信中，MAC 包头的协议类型只使用：</p><ul><li>IP 协议：0x0800</li><li>ARP 协议：0x0806</li></ul><p>此时的数据已经被封装成如下形式：</p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%94%AE%E5%85%A5%E7%BD%91%E5%9D%80%E8%BF%87%E7%A8%8B/21.jpg" alt="图8 数据链路层的报文" width="500"><blockquote><p>那么如何获取接收方的 MAC 地址呢？</p></blockquote><p>此时就会用到 ARP 协议，ARP 协议会在以太网中以广播的形式发送”Who has ··· IP ? Tell me ··· IP” ，对以太网所有的设备发送 ARP 请求。</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/20240825195508.png" alt="图9 Wireshark 抓包ARP 协议" width="700"><p>如果对方和自己处于同一个子网中，那么通过上面的操作就可以得到对方的 MAC 地址。然后，我们将这个 MAC 地址写入 MAC 头部，MAC 头部就完成了。</p><p>当然，并不是每次转发网络包都要使用 ARP 协议，只要查询过一次<code>&lt;IP, MAC&gt;</code>就会将其存放到 ARP 缓存中去方便之后使用，只不过缓存的时间就几分钟。</p><p>也就是说，网络包实际的请求过程为：</p><ol><li>先查询 ARP 缓存，如果其中保存了对方的 MAC 地址，那么就不需要使用 ARP 查询，直接拿来使用。</li><li>否则，就使用 ARP 请求广播去请求对方的 MAC 地址。</li></ol><h4 id="网卡：发送出口"><a href="#网卡：发送出口" class="headerlink" title="网卡：发送出口"></a>网卡：发送出口</h4><p>网络包只是存放在内存中的一串二进制编码。因此，想要发送这些信息，需要将<strong>数字信号转换为电信号</strong>，才能在网线上传输，这才是真正的数据发送过程。</p><p>负责这一操作的是<strong>网卡</strong>，要控制网卡还需要靠<strong>网卡驱动程序</strong>。网卡驱动获取网络包之后，会将其<strong>复制</strong>到网卡内的缓存区中，接着会在其<strong>开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列（FCS）</strong>。</p><ul><li>起始帧分界符：标识包起始位置的标记</li><li>FCS：用于差错检验</li></ul><h4 id="交换机：送别者"><a href="#交换机：送别者" class="headerlink" title="交换机：送别者"></a>交换机：送别者</h4><p>交换机的设计是将网络包<strong>原样</strong>转发到目的地。其工作在 MAC 层。其工作过程如下：</p><ol><li>电信号到达网线接口，交换机里的模块进行接收，将电信号转换为数字信号。</li><li>通过末尾的 FCS 校验差错，如果没有问题则放到缓冲区。</li><li>存入缓冲区之后，查询这个包的接收方 MAC 地址是否已经在 MAC 地址表中有记录。交换机的 MAC 地址表主要包含两个信息：<ul><li>设备的 MAC 地址</li><li>该设备连接在交换机的哪一个端口上</li></ul></li><li>如果查询到了对应的 MAC 地址，则发送到对应的端口上；否则，只能将包转发到除了源端口之外的所有端口上，无论该设备连接在哪个端口上都能收到这个包。</li></ol><p>此外，如果接收到的 MAC 地址是一个<strong>广播地址</strong>，那么交换机会将包发送到除源端口之外的所有端口。</p><ul><li>MAC 地址中的广播：<code>FF:FF:FF:FF:FF:FF</code></li><li>IP 地址中的广播：<code>255.255.255.255</code></li></ul><h4 id="路由器：处境大门"><a href="#路由器：处境大门" class="headerlink" title="路由器：处境大门"></a>路由器：处境大门</h4><p>路由器的转发工作原理和交换机类似，也是通过查表判断包转发的目标。但在具体的操作过程，两者有些区别：</p><ul><li>路由器基于 IP 设计：俗称三层网络设备，其各个端口都具有 MAC 地址和 IP 地址。</li><li>交换机基于 MAC 设计：俗称二层网络设备，其端口不具有 MAC 地址。</li></ul><p>以下分解路由器转发包的过程：</p><ol><li>首先路由器端口会接收发给自己的以太网包，首先将其转化为数字信号，通过包末尾的 FCS 进行错误校验，如果校验不通过则丢弃该包。</li><li>接着<strong>检查 MAC 地址的接受方是否为自己</strong>，如果不是路由器端口的 MAC 地址，则丢弃；否则将数据包放入缓冲区中。</li><li>完成包接收工作后，路由器就会去掉包开头的 MAC 头部。MAC 头部的作用就是将包送达路由器，因此其任务已经完成。接着路由器会根据 MAC 头部后方的 IP 头部中的内容进行包转发，转发通过<strong>查询路由表</strong>判断下一步转发的目标。</li></ol><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%94%AE%E5%85%A5%E7%BD%91%E5%9D%80%E8%BF%87%E7%A8%8B/24.jpg" alt="图10 路由表" width="500"><ol start="4"><li>根据匹配得到的路由条目判断对方的地址，一共有两种情况：<ul><li>如果网关是一个 IP 地址，则这个 IP 地址就是要转发到的目标地址，还未到达目标网络，需要继续路由转发。</li><li>如果网关未空，则 IP 头部的接收方 IP 地址就是要转发的目标地址，也是找到了目标网络。</li></ul></li><li>由于之前丢弃了 MAC 头部，因此还需要通过 ARP 协议根据 IP 地址查询目标的 MAC 地址，将查询的结果作为接收方的 MAC 地址。通过 ARP 协议或者缓存中获取到了目标的 MAC 地址，那么需要源 MAC 地址，这个地址就是发送端口的 MAC 地址，再加以太类型字段，填写<code>0x0800</code>表示 IP 协议。</li><li>网络包完成后，接下来会将其转换成电信号并通过端口发送出去。</li><li>如果已经在目标网络，那么通过交换机转发就能到达目的地；否则，还需要通过路由器转发，直到到达目标网络，最后到达目的地。</li></ol><h4 id="服务器与客户端：一个装一个拆"><a href="#服务器与客户端：一个装一个拆" class="headerlink" title="服务器与客户端：一个装一个拆"></a>服务器与客户端：一个装一个拆</h4><p>数据包送达到了服务器端口后，会经历如下几个步骤：</p><ol><li>首先查看数据包的 MAC 头部，是否和服务器自己的 MAC 地址匹配。</li><li>接着查看数据包的 IP 头，查看 IP 地址是否符合，并且根据 IP 头中的协议项，知道上一层是 TCP 协议。</li><li>接着查看数据包的 TCP 头，查看序列号，看看序列号是不是想要的，如果是就放入缓存中然后返回一个 ACK，否则就将该包丢弃。TCP 头部里还有端口号，此时 HTTP服务器正监听该端口。</li><li>服务器接着将该包发送给 HTTP 进程。</li><li>HTTP 进程发现该包要请求网页，于是将这个网页封装在 HTTP 响应报文里。</li><li>HTTP 响应报文加上 TCP、IP、MAC 头部，只是其源地址为服务器 IP 地址，目标地址是客户端 IP 地址。然后从网卡中发送出去。</li><li>客户端手打送响应数据包后，同样的方式进行拆包，得到 HTTP 响应报文，交给浏览器去渲染页面。</li><li>最后，客户端向服务器发起 TCP 四次挥手，至此双方的连接就断开了。</li></ol><h2 id="3-传输层"><a href="#3-传输层" class="headerlink" title="3. 传输层"></a>3. 传输层</h2><h3 id="3-1-传输层总览"><a href="#3-1-传输层总览" class="headerlink" title="3.1 传输层总览"></a>3.1 传输层总览</h3><div class="markmap-container" style="height:300px"><svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;传输层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;提供服务：进程之间的逻辑通信、复用和分用、差错检验、面向连接的TCP和无连接的UDP&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;UDP协议&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;特点：无连接、多对多、首部开销小、最大努力交付，应用层要保证可靠性&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;首部：8B，分别为源端口号、目的端口号、长度、校验和&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;TCP协议&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;特点：有连接、一对一、提供可靠交付、全双工通信、面向字节流&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;首部：20B，源端口，目的端口、序号、确认号、标志、窗口等&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;连接管理：三次握手建立，四次挥手释放&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;可靠传输&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;序号：用来保证数据能有序提交给应用层&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;确认：确认号为期待收到的下一个报文段第一个字节的序号&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;重传&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;超时：计时器到期未收到&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;冗余确认：当收到失序报文时向发送端发送冗余ACK&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;流量控制：在确认报文中设置接收串口rwnd的值来限制发送速率&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;拥塞控制：&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;原理：根据自己估算网络拥塞成都设置cwnd的值来限制发送速率&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;方法：&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;慢开始：当cwnd&amp;lt;ssthresh时，&lt;strong&gt;每收到一个报文段&lt;/strong&gt;cwnd ++&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;拥塞避免：当cwnd&amp;gt;ssthresh时，&lt;strong&gt;每经过一个往返延时&lt;/strong&gt;cwnd ++&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;快重传：当收到连续三个重复 ACK，直接重传对方期待的报文。&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;快恢复：当收到连续的三个冗余 ACK。令 cwnd=cwnd/2, ssthresh=cwnd。&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;拥塞实力：令 ssthresh=cwnd/2, cwnd设置为初始值&quot;}]}]}]}"></svg></div><h3 id="3-2-传输层的功能"><a href="#3-2-传输层的功能" class="headerlink" title="3.2 传输层的功能"></a>3.2 传输层的功能</h3><ol><li>传输层提供应用进程之间的逻辑通信，即<strong>端到端的通信</strong>。与网络层的区别是，网络层提供的是<strong>主机之间的逻辑通信</strong>。从网络层来说，通信的双方是两台主机，IP 数据报的首部给出了这两台主机的 IP 地址。但两台主机实际上是两台主机中的应用进程之间的通信。</li><li>复用和分用。复用是指发送方不同的应用进程都可以使用同一个传输层协议传送数据；分用是指接收方的传输层在剥去报文首部后能够把数据正确交付到目标应用程序。</li><li>传输层会对收到的报文进行差错检验。而网络层只检查 IP 数据包的首部，不检查数据部分是否出错。</li><li>提供两种不同的传输协议，即面向连接的 TCP 和无连接的 UDP。</li></ol><h3 id="3-3-TCP-协议"><a href="#3-3-TCP-协议" class="headerlink" title="3.3 TCP 协议"></a>3.3 TCP 协议</h3><h4 id="TCP-头部有哪些字段？"><a href="#TCP-头部有哪些字段？" class="headerlink" title="TCP 头部有哪些字段？"></a>TCP 头部有哪些字段？</h4><ul><li>序列号：建立连接时生成的随机数作为其初始值，通过 SYN 包传给接收主机，每发送一次数据就累加一次数据字节数的大小。用来解决网络包乱序问题。</li><li>确认应答号：表示下一次期望收到的数据的序列号，发送端收到这个确认应答以后认为在这个序号以前的数据都已经被正常接收。用来处理丢包问题。</li><li>控制位标志：<ul><li>ACK ：置<code>1</code>时，表示确认应答字段变为有效，TCP 规定除了最初建立连接时的 SYN 包之外都必须置为<code>1</code>。</li><li>RST ：置<code>1</code>时，表示 TCP 连接出现异常必须强制断开连接。</li><li>SYN ：置<code>1</code>时，表示希望建立连接，并在其序列号字段进行序列号初始值设置。</li><li>FIN : 置<code>1</code>时，表示之后不会再有数据发送，希望断开连接。断开连接时，双方互相交换 FIN 为<code>1</code>的 TCP 段。</li></ul></li></ul><h4 id="为何要使用-TCP-协议"><a href="#为何要使用-TCP-协议" class="headerlink" title="为何要使用 TCP 协议"></a>为何要使用 TCP 协议</h4><p><code>IP</code>层是不可靠的，它不保证网络包的交付、不保证网络包的按序交付、也不保证网络包中的数据的完整性。因此就需要上层的<code>TCP</code>协议去负责可靠性。确保接收到的网络包是<strong>无损坏、无间隔、非冗余和按序</strong>的。</p><h4 id="什么是-TCP-连接？"><a href="#什么是-TCP-连接？" class="headerlink" title="什么是 TCP 连接？"></a>什么是 TCP 连接？</h4><p>建立一个 TCP 连接是需要客户端与服务端达成三个信息的共识：</p><ul><li>Socket ： 由 IP 地址和端口号组成</li><li>序列号：用来解决乱序问题等</li><li>窗口大小：用来做流量控制</li></ul><h4 id="TCP-三次握手过程"><a href="#TCP-三次握手过程" class="headerlink" title="TCP 三次握手过程"></a>TCP 三次握手过程</h4><p>TCP 是面向连接的协议，所以使用 TCP 前必须建立连接，而建立连接是通过三次握手来进行的。三次握手的过程如下所示：</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/35-handshake.png" alt="图11 三次握手" width="500"><ol><li>客户端随机初始化序号（client_isn），将序号放到 TCP 首部的序号字段中，同时把 SYN 标志位设置为<code>1</code>，表示该报文是 SYN 报文。接着发送该报文给服务端。</li><li>服务端收到客户端的 SYN 报文后，首先服务端也随机初始化自己的序号（server_isn），将此序号填入 TCP 首部的序号字段中，其次把 TCP 首部的确认应答号字段填入<code>client_isn + 1</code>，接着 SYN 和 ACK 标志位设置为 1。最后把该报文发送给客户端，该报文也不包含应用层数据。</li><li>客户端收到服务端报文后，返回最后一个应答报文给客户端，首先该应答报文 TCP 首部 ACK 标志位置为<code>1</code>，其次确认应答号填入<code>server_isn + 1</code>，最后发送报文给服务端，这次报文可以携带客户到服务端的数据。</li></ol><h4 id="为何-TCP-连接时三次握手？"><a href="#为何-TCP-连接时三次握手？" class="headerlink" title="为何 TCP 连接时三次握手？"></a>为何 TCP 连接时三次握手？</h4><p>之所以需要三次握手原因是：</p><ul><li>三次握手才可以阻止重复历史连接的初始化<ul><li>两次握手的情况下，服务器没有中间状态给客户端来阻止历史连接，导致服务器可能建立一个历史连接，造成资源浪费。为了解决这个问题，就需要在服务器发送数据前，阻止历史连接，所以需要三次握手。</li></ul></li><li>三次握手才可以同步双方的初始序号<ul><li>两次握手只能保证一方的初始序列号能被对方成功接收，没办法保证双方的初始序列号都能被正确收到。</li></ul></li><li>三次握手才可以避免资源浪费</li></ul><p>不使用两次握手和四次握手的原因：</p><ul><li>两次握手：无法防止历史连接的建立，会造成双方资源的浪费，也无法可靠的同步序列号。</li><li>四次握手：三次握手足够实现连接信息同步，因此没必要使用四次握手。</li></ul><h4 id="为什么需要随机初始化序列号？"><a href="#为什么需要随机初始化序列号？" class="headerlink" title="为什么需要随机初始化序列号？"></a>为什么需要随机初始化序列号？</h4><p>随机初始化序列号的原因是：</p><ul><li>为了防止历史报文被下一个相同的四元组的连接接收</li><li>为了安全性，防止黑客伪造相同序列号的 TCP 报文被对方接收</li></ul><h4 id="IP-层能分片，那MSS什么用？"><a href="#IP-层能分片，那MSS什么用？" class="headerlink" title="IP 层能分片，那MSS什么用？"></a>IP 层能分片，那MSS什么用？</h4><ul><li>MTU ：一个网络包的最大长度，以太网中为 1500 字节</li><li>MSS ： 去除 IP 和 TCP 头部之后，一个网络包所能容纳的 TCP 数据的最大长度</li></ul><p>看似 MSS 的设置没有必要，实则十分重要。这是因为在 IP 层并没有超时重传机制，如果一个 IP 分片丢失，那么整个 IP 报文的所有分片都要重传，如果这个 IP 报文设置的过长，那么会降低重传的效率。所以，在建立连接的时候，通信双方需要协商 MSS 值，如果超过 MSS 就需要对数据进行分片，分完片的数据包不会超过 MTU 所设置的长度，自然也不会在 IP 层进行分片，因此大大增加重传的效率。</p><h4 id="TCP-四次挥手过程"><a href="#TCP-四次挥手过程" class="headerlink" title="TCP 四次挥手过程"></a>TCP 四次挥手过程</h4><p>TCP 四次握手双方都可以主动断开连接，断开连接后主机中的资源将被释放，过程如下：</p><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/76ca70b09950ea27e18101a84a53f5ccdb60e2.png" width="400" alt="图12 TCP 四次挥手"><ol><li>客户端打算关闭连接，因此发送一个 TCP 首部 FIN 标志置 1 的报文给服务端。</li><li>服务端收到该报文后，就向客户端发送 ACK 应答报文。</li><li>等待服务端将数据处理完后，也向客户端发送 FIN 报文。</li><li>客户端收到服务端的 FIN 报文后，回应一个 ACK 应答报文。</li><li>服务端收到 ACK 后关闭连接。</li><li>客户端经过<code>2MSL</code>时间后，也关闭连接。</li></ol><blockquote><p>Notice : 主动关闭连接的一方，才有 TIME_WAIT 状态</p></blockquote><h4 id="为什么要设置-TIME-WAIT-状态"><a href="#为什么要设置-TIME-WAIT-状态" class="headerlink" title="为什么要设置 TIME_WAIT 状态"></a>为什么要设置 TIME_WAIT 状态</h4><ul><li>为了防止历史连接中的数据，被后面相同四元组的连接错误的接收<ul><li>足以让两个方向上的数据包都被丢弃，使得原来连接的数据包在网络中都自然消失，再出现的数据包一定都是新建立连接所产生的。</li></ul></li><li>保证被动关闭连接的一方，能被正确的关闭<ul><li>等待足够的时间以确保最后的 ACK 能让被动关闭方接收，从而帮助其正常关闭</li></ul></li></ul><h4 id="序列号和确认号如何变化"><a href="#序列号和确认号如何变化" class="headerlink" title="序列号和确认号如何变化"></a>序列号和确认号如何变化</h4><p>发送 TCP 报文的规律可以总结如下：</p><ul><li>公式一：$\text{序列号}&#x3D;\text{上次发送的序列号} + len(数据长度)$。特殊情况，如果上一次发送的 SYN 报文或是 FIN 报文，则改为 $\text{上次发送的序列号}+1$。</li><li>公式二：$确认号 &#x3D; 上一次收到的报文中的序列号 + len(数据长度)$。特殊情况，如果收到的是 SYN 报文或者 FIN 报文，则改为 $\text{上一次收到的报文中的序列号} + 1$。</li></ul><h3 id="3-4-UDP协议"><a href="#3-4-UDP协议" class="headerlink" title="3.4 UDP协议"></a>3.4 UDP协议</h3><h3 id="3-5-TCP协议与UDP协议区别"><a href="#3-5-TCP协议与UDP协议区别" class="headerlink" title="3.5 TCP协议与UDP协议区别"></a>3.5 TCP协议与UDP协议区别</h3><ol><li>连接</li></ol><ul><li>TCP 是面向连接的传输层协议，传输数据前先要建立连接。</li><li>UDP 是不需要连接，即刻传输数据。</li></ul><ol start="2"><li>服务对象</li></ol><ul><li>TCP 是一对一的两点服务，即一条连接只有两个端点。</li><li>UDP 支持一对一，一对多，多对多的交互通信。</li></ul><ol start="3"><li>可靠性</li></ol><ul><li>TCP 是可靠交付数据的，数据可以无差错、不丢弃、不重复、按序到达。</li><li>UDP 是尽最大努力交付，不保证可靠交付数据。</li></ul><ol start="4"><li>拥塞控制、流量控制</li></ol><ul><li>TCP 有拥塞控制和流量控制，保证数据传输的安全性。</li><li>UDP 则没有。</li></ul><ol start="5"><li>首部开销</li></ol><ul><li>TCP 首部长度较长，在没有选项字段的是 20 个字节。</li><li>UDP 首部只有 8 个字节，并且固定不变的，开销较小。</li></ul><ol start="6"><li>传输方式</li></ol><ul><li>TCP 是流式传输，没有边界，但保证顺序和可靠。</li><li>UDP 是一个包一个包传输的，有边界，可能会丢包和乱序。</li></ul><ol start="7"><li>分片不同</li></ol><ul><li>TCP 的数据大小如果大于 MSS 大小，则会在传输层进行分片，到达主机后在传输层组装 TCP 数据包，如果中途丢失了一个分片，只需要重传这个分片。</li><li>UDP 的数据大小如果大于 MTU 大小，则会在 IP 层进行分片，目标主机收到后，在 IP 层组装完数据，接着传给传输层。</li></ul><h2 id="4-网络层"><a href="#4-网络层" class="headerlink" title="4. 网络层"></a>4. 网络层</h2><h3 id="4-1-网络层总览"><a href="#4-1-网络层总览" class="headerlink" title="4.1 网络层总览"></a>4.1 网络层总览</h3><div class="markmap-container" style="height:450px"><svg data="{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:2,&quot;p&quot;:{&quot;lines&quot;:[1,2]},&quot;v&quot;:&quot;网络层&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[2,3]},&quot;v&quot;:&quot;功能：异构网络互联、路由与转发、拥塞控制&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[3,4]},&quot;v&quot;:&quot;路由算法&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[4,5]},&quot;v&quot;:&quot;静态：由网络管理员手动配置路由信息&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[5,6]},&quot;v&quot;:&quot;动态：通过路由器间彼此交换的信息来构造路由表，分为&lt;code&gt;距离-向量&lt;/code&gt;和&lt;code&gt;链路状态&lt;/code&gt;算法。&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[6,7]},&quot;v&quot;:&quot;层次路由&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[7,8]},&quot;v&quot;:&quot;概念：将互联网分成许多较小的自治系统，系统有权决定内部采用什么路由协议&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[8,9]},&quot;v&quot;:&quot;协议&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[9,10]},&quot;v&quot;:&quot;内部网关协议：RIP、OSPF&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[10,11]},&quot;v&quot;:&quot;外部网关协议：BGP4&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[11,12]},&quot;v&quot;:&quot;IPv4&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[12,13]},&quot;v&quot;:&quot;首部：固定部分共20B。&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[13,14]},&quot;v&quot;:&quot;NAT：专门实现专用网络地址和公用网络地址的互相转换&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[14,15]},&quot;v&quot;:&quot;CIDR：在变长子网掩码的基础上提出的一种消除传统A、B、C类网络划分&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[15,16]},&quot;v&quot;:&quot;路由聚合&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[16,17]},&quot;v&quot;:&quot;概念：将网络前缀都相同的连续的IP地址组成CIDR地址块&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[17,18]},&quot;v&quot;:&quot;目的：使得一个地址块可以表示很多地址，减少路由表表项和路由器间的信息交换&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[18,19]},&quot;v&quot;:&quot;方法：把一串IP地址都写成二进制，取最长的公共前缀作为网络号&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[19,20]},&quot;v&quot;:&quot;协议&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[20,21]},&quot;v&quot;:&quot;ARP：对于特定的IP地址，查询其对应的物理地址&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[21,22]},&quot;v&quot;:&quot;DHCP：给网络中的主机动态的分配IP地址&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[22,23]},&quot;v&quot;:&quot;ICMP：用来给主机或路由器报告差错和异常情况&quot;}]}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[23,24]},&quot;v&quot;:&quot;IPv6：首部40B，地址长度16B，主要用于解决IPv4用尽问题&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:4,&quot;p&quot;:{&quot;lines&quot;:[24,25]},&quot;v&quot;:&quot;路由协议&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[25,26]},&quot;v&quot;:&quot;IGP&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[26,27]},&quot;v&quot;:&quot;RIP协议：基于距离向量路由选择协议，使用UDP，与相邻路由器交换整个路由表&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[27,28]},&quot;v&quot;:&quot;OSPF协议：基于链路状态路由算法，使用IP，与全部路由器交换相邻结点链路状态&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[28,29]},&quot;v&quot;:&quot;EGP&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[29,30]},&quot;v&quot;:&quot;BGP协议：基于路径向量路由选择协议，使用TCP，寻找的并非最佳路由&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[30,31]},&quot;v&quot;:&quot;移动IP&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[31,32]},&quot;v&quot;:&quot;概念：移动结点以固定的网络IP地址，实现跨越不同网段的漫游功能&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[32,33]},&quot;v&quot;:&quot;组成：移动结点、本地代理、外部代理&quot;}]},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:6,&quot;p&quot;:{&quot;lines&quot;:[33,34]},&quot;v&quot;:&quot;路由器&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[34,35]},&quot;v&quot;:&quot;特点：可以用来连接异构网络，完成路由转发，能隔离冲突域和广播域，依照IP地址转发&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:8,&quot;p&quot;:{&quot;lines&quot;:[35,36]},&quot;v&quot;:&quot;组成&quot;,&quot;c&quot;:[{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[36,37]},&quot;v&quot;:&quot;控制部分：路由选择处理机，根据路由协议构造与维护路由表&quot;},{&quot;t&quot;:&quot;list_item&quot;,&quot;d&quot;:10,&quot;p&quot;:{&quot;lines&quot;:[37,38]},&quot;v&quot;:&quot;分组转发部分：交换结构、一组输入端口和一组输出端口&quot;}]}]}]}]}"></svg></div><h4 id="路由器的主要功能"><a href="#路由器的主要功能" class="headerlink" title="路由器的主要功能"></a>路由器的主要功能</h4><p>路由器主要完成两个功能：一个是路由选择（确定哪一条路径），另一个就是分组转发（当一个分组到达时采取的动作）。前者根据路由选择协议构造出路由表，同时经常或定时地和相邻路由器交换路由信息而不断地更新和维护路由表；后者处理通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管理和任务调度。</p><h4 id="RIP-距离-向量路由算法"><a href="#RIP-距离-向量路由算法" class="headerlink" title="RIP 距离-向量路由算法"></a>RIP 距离-向量路由算法</h4><p>路由信息协议（Routing Information Protocol，RIP ）是自治系统内部一个可以使用的路由选择协议，是基于距离向量的路由选择协议，其最大有点就是简单，其规定：</p><ol><li>网络中的每个路由器都要维护从它自身到其每个目的网络的距离记录。</li><li>距离也称为跳数，规定从一个路由器到直接连接网络的距离为 1，而经过一个路由器，距离加1。</li><li>RIP 认为好的路由就是通过的路由器的数量少，即优先选择跳数少的路径。</li><li>RIP 允许一条路径最多只能包含 15 个路由器。距离为 16 时则表示网络不可达。因此 RIP 只适用于小型互联网。最高跳数的目的时为了防止数据包不断循环在环路上，减少网络拥塞的可能性。</li><li>RIP 默认在任意两个使用 RIP 的路由器之间每 30s 广播一次 RIP 更新信息，从而实现动态维护。</li></ol><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/20240826175017.png" alt="图13 RIP 更新方式" width="550"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Chen</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: </i></span><span class="reprint-info"><a href="https://tiredace.github.io/posts/Interview-Computer-Network.html">https://tiredace.github.io/posts/Interview-Computer-Network.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Chen</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Computer-Network/"><span class="chip bg-color">Computer Network</span> </a><a href="/tags/Interview/"><span class="chip bg-color">Interview</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/zfb.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/weixin.jpg" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><style>.valine-card{margin:1.5rem auto}.valine-card .card-content{padding:20px 20px 5px 20px}#vcomments textarea{box-sizing:border-box;background:url(/medias/comment_bg.png) 100% 100% no-repeat}#vcomments p{margin:2px 2px 10px;font-size:1.05rem;line-height:1.78rem}#vcomments blockquote p{text-indent:.2rem}#vcomments a{padding:0 2px;color:#4cbf30;font-weight:500;text-decoration:none}#vcomments img{max-width:100%;height:auto;cursor:pointer}#vcomments ol li{list-style-type:decimal}#vcomments ol,ul{display:block;padding-left:2em;word-spacing:.05rem}#vcomments ul li,ol li{display:list-item;line-height:1.8rem;font-size:1rem}#vcomments ul li{list-style-type:disc}#vcomments ul ul li{list-style-type:circle}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}#vcomments table,td,th{border:0}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments h1{font-size:1.85rem;font-weight:700;line-height:2.2rem}#vcomments h2{font-size:1.65rem;font-weight:700;line-height:1.9rem}#vcomments h3{font-size:1.45rem;font-weight:700;line-height:1.7rem}#vcomments h4{font-size:1.25rem;font-weight:700;line-height:1.5rem}#vcomments h5{font-size:1.1rem;font-weight:700;line-height:1.4rem}#vcomments h6{font-size:1rem;line-height:1.3rem}#vcomments p{font-size:1rem;line-height:1.5rem}#vcomments hr{margin:12px 0;border:0;border-top:1px solid #ccc}#vcomments blockquote{margin:15px 0;border-left:5px solid #42b983;padding:1rem .8rem .3rem .8rem;color:#666;background-color:rgba(66,185,131,.1)}#vcomments pre{font-family:monospace,monospace;padding:1.2em;margin:.5em 0;background:#272822;overflow:auto;border-radius:.3em;tab-size:4}#vcomments code{font-family:monospace,monospace;padding:1px 3px;font-size:.92rem;color:#e96900;background-color:#f8f8f8;border-radius:2px}#vcomments pre code{font-family:monospace,monospace;padding:0;color:#e8eaf6;background-color:#272822}#vcomments pre[class*=language-]{padding:1.2em;margin:.5em 0}#vcomments code[class*=language-],pre[class*=language-]{color:#e8eaf6}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}#vcomments b,strong{font-weight:700}#vcomments dfn{font-style:italic}#vcomments small{font-size:85%}#vcomments cite{font-style:normal}#vcomments mark{background-color:#fcf8e3;padding:.2em}#vcomments table,td,th{padding:12px 13px;border:1px solid #dfe2e5}table tr:nth-child(2n),thead{background-color:#fafafa}#vcomments table th{background-color:#f2f2f2;min-width:80px}#vcomments table td{min-width:80px}#vcomments [type=checkbox]:not(:checked),[type=checkbox]:checked{position:inherit;margin-left:-1.3rem;margin-right:.4rem;margin-top:-1px;vertical-align:middle;left:unset;visibility:visible}</style><div class="card valine-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="vcomments" class="card-content" style="display:grid"></div></div><script src="/libs/valine/av-min.js"></script><script src="/libs/valine/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"4NJtDMCIeABTljsAFON3dMv5-MdYXbMMI",appKey:"ouJ8dl90Z0I5Qi20VwLQUny3",serverURLs:"https://4njtdmci.api.lncldglobal.com",notify:!1,verify:!1,visitor:!0,avatar:"mm",pageSize:"10",lang:"zh-cn",placeholder:"just go go"})</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="far fa-dot-circle"></i>&nbsp;本篇</div><div class="card"><a href="/posts/Interview-Computer-Network.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/b271e2b2707f3530b45cf76acededfe37f07fd9ce20b277e0ba55c8597491243.jpg" class="responsive-img" alt="Computer Network Basics"> <span class="card-title">Computer Network Basics</span></div></a><div class="card-content article-content"><div class="summary block-with-text">计算机网络知识点汇总</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-08-24 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Computer-Basics/" class="post-category">Computer Basics</a></span></div></div><div class="card-action article-tags"><a href="/tags/Computer-Network/"><span class="chip bg-color">Computer Network</span> </a><a href="/tags/Interview/"><span class="chip bg-color">Interview</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/How-to-study.html"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/TiredAce/pictures/img/1.jpg" class="responsive-img" alt="How to study"> <span class="card-title">How to study</span></div></a><div class="card-content article-content"><div class="summary block-with-text">在当今瞬息万变的世界里，学习的能力和效率至关重要。本文将探讨如何高效自学。</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-08-23 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Study/" class="post-category">Study</a></span></div></div><div class="card-action article-tags"><a href="/tags/Study/"><span class="chip bg-color">Study</span></a></div></div></div></div></article></div><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/prism/prism.min.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})</script><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2024</span> &nbsp;<i id="heartbeat" class="fa fas fa-heartbeat"></i>&nbsp; <a href="/about" target="_blank">Chen</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span class="white-color">14.9k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e,t,n=new Date,i="2024",a=n.getFullYear(),r=n.getMonth()+1,o=n.getDate(),s=n.getHours(),g=n.getMinutes(),d=n.getSeconds(),m=Date.UTC(i,"8","18","0","0","0"),c=Date.UTC(a,r,o,s,g,d)-m,l=Math.floor(c/31536e6),u=Math.floor(c/864e5-365*l);i===String(a)?(document.getElementById("year").innerHTML=a,e="This site has been running for "+u+" days",e="本站已安全运行 "+u+" 天",document.getElementById("sitetime").innerHTML=e):(document.getElementById("year").innerHTML=i+" - "+a,t="This site has been running for "+l+" years and "+u+" days",t="本站已安全运行 "+l+" 年 "+u+" 天",document.getElementById("sitetime").innerHTML=t)};calcSiteTime()</script><br><span id="icp"><img src="/medias/icp.png" style="vertical-align:text-bottom"> <a href="https://beian.miit.gov.cn" target="_blank">陕ICP 备2024047344 号</a></span></div><div class="col s12 m4 l4 social-link social-statis"><style>@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}.my-icon:hover{animation:bounce 1s infinite}</style><a href="https://github.com/TiredAce" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github my-icon"></i> </a><a href="mailto:tiredace614@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open my-icon"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1125953304" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1125953304" data-position="top" data-delay="50"><i class="fab fa-qq my-icon"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,s,i){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),n=document.getElementById(s),r=document.getElementById(i);n.addEventListener("input",function(){var f='<ul class="search-result-list">',m=this.value.trim().toLowerCase().split(/[\s\-]+/);r.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s,i,l=!0,a=t.title.trim().toLowerCase(),c=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),u=0===(u=t.url).indexOf("/")?t.url:"/"+u,o=-1,h=-1;""!==a&&""!==c&&m.forEach(function(t,e){n=a.indexOf(t),o=c.indexOf(t),n<0&&o<0?l=!1:(o<0&&(o=0),0===e&&(h=o))}),l&&(f+="<li><a href='"+u+"' class='search-result-title'>"+a+"</a>",e=t.content.trim().replace(/<[^>]+>/g,""),0<=h&&(s=h+80,(r=h-20)<0&&(r=0),0===r&&(s=100),s>e.length&&(s=e.length),i=e.substr(r,s),m.forEach(function(t){var e=new RegExp(t,"gi");i=i.replace(e,'<em class="search-keyword">'+t+"</em>")}),f+='<p class="search-result">'+i+"...</p>"),f+="</li>")}),f+="</ul>",r.innerHTML=f)})}})}("/search.xml","searchInput","searchResult")})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/fireworks.js"></script><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script type="text/javascript">var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>')</script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" color="0,0,255" pointcolor="0,0,255" opacity="0.7" zindex="-1" count="99" src="/libs/background/canvas-nest.js"></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script type="text/javascript">var windowWidth=$(window).width();document.write('<script type="text/javascript" src="/libs/others/bubble.js"><\/script>')</script><script src="/js/markmap.js"></script></body></html>